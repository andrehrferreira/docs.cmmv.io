<ul class="p-4 select-none" c-cloak c-show="docs">
    <li c-for="(item, key) in docs.navbar">
        <div 
            class="flex hover:text-blue-700 itemRoot text-white" 
            opened="false" 
            :id="item.name.replace(/\s/,'_')" 
            onclick="toggle(item.name.replace(/\s/, `_`))"
            c-show="item"
        >
            <div class="flex flex-1 font-bold text-md cursor-pointer">
                <a :href="item.uri" c-if="item && item.isDir" class="text-white">{{ item.name }}</a>
                <span c-else class="text-white" c-else-if="item">{{ item.name }}</span>
            </div>

            <div class="justify-between cursor-pointer" c-if="item.isDir">
                <i class="fa-solid fa-angle-down" :id="`${item.name.replace(/\s/, `_`)}_open`"></i>
                <i class="fa-solid fa-angle-up" style="display: none;" :id="`${item.name.replace(/\s/, `_`)}_close`"></i>
            </div>
        </div>

        <ul 
            c-if="item && item.children && item.children.length > 0"
            :id="`${item.name.replace(/\s/, `_`)}_contents`" 
            class="p-4 py-1 text-md"
        >
            <li c-for="(child) in item.children">
                <div class="hover:text-gray-800 text-white text-base p-1" style="font-size: 12px">
                    <a :href="child.uri" class="text-base">{{ child.name }}</a>
                </div>
            </li>
        </ul>
    </li>
</ul>

<script s-attr="nonce">
function toggle(id) {
    const rootElement = document.getElementById(id);
    const isOpened = rootElement.getAttribute('opened') === 'true';
    rootElement.setAttribute('opened', !isOpened);

    const contentElement = document.getElementById(`${id}_contents`);
    const openIcon = document.getElementById(`${id}_open`);
    const closeIcon = document.getElementById(`${id}_close`);

    if (!isOpened) {
        contentElement.style.display = 'block';
        openIcon.style.display = 'none';
        closeIcon.style.display = 'block';
    } else {
        contentElement.style.display = 'none';
        openIcon.style.display = 'block';
        closeIcon.style.display = 'none';
    }

    saveState();
}

function saveState() {
    const state = {};
    const items = document.querySelectorAll('.itemRoot');

    items.forEach(item => {
        const id = item.getAttribute('id');
        state[id] = item.getAttribute('opened');
    });

    localStorage.setItem('navbar', JSON.stringify(state));
}

function loadState() {
    const state = JSON.parse(localStorage.getItem('navbar'));

    if (state) {
        for (const key in state) {
            const rootElement = document.getElementById(key);
            const contentElement = document.getElementById(`${key}_contents`);
            const openIcon = document.getElementById(`${key}_open`);
            const closeIcon = document.getElementById(`${key}_close`);

            const isOpened = state[key] === 'true';
            rootElement.setAttribute('opened', isOpened);

            if (isOpened) {
                contentElement.style.display = 'block';
                openIcon.style.display = 'none';
                closeIcon.style.display = 'block';
            } else {
                contentElement.style.display = 'none';
                openIcon.style.display = 'block';
                closeIcon.style.display = 'none';
            }
        }
    }
}

loadState();
</script>
