<h1>Serialization</h1><a id="serialization" title="Serialization"></a>
<p>Serialization and deserialization in a project using <code>class-transformer</code> are crucial for converting JavaScript objects into specific class instances and vice versa. In the example above, the <code>Task</code> class, automatically generated by <code>@cmmv/core</code>, can be serialized and validated, ensuring the application processes data safely and with correct typing.</p>
<p>The goal of serialization is to transform data into appropriate class instances, ensuring the objects being manipulated have the correct properties and types. We use the <code>class-transformer</code> package for serializing and deserializing objects and <code>class-validator</code> to validate the data.</p>
<p>Here’s an implementation of a <code>Task</code> model that represents a task and uses <code>class-validator</code> and <code>class-transformer</code> to ensure proper serialization and validation of fields:</p>
<div class="code-block-container">
                <button class="copy-code-btn" onclick="copyToClipboard(this)" title="Copy">
                    <i class="fa-regular fa-clone"></i>
                </button>
                <pre><code class="hljs language-typescript" lang="typescript""><span class="hljs-comment">// Generated automatically by CMMV</span>

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">IsString</span>, <span class="hljs-title class_">IsNotEmpty</span>, <span class="hljs-title class_">IsBoolean</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;class-validator&#x27;</span>;
<span class="hljs-keyword">import</span> { plainToClass, classToPlain } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;class-transformer&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ITask</span> {
    id?: <span class="hljs-built_in">any</span>;
    <span class="hljs-attr">label</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">checked</span>: <span class="hljs-built_in">boolean</span>;
    <span class="hljs-attr">removed</span>: <span class="hljs-built_in">boolean</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ITask</span> {
    id?: <span class="hljs-built_in">any</span>;

    <span class="hljs-meta">@IsString</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;Invalid label&#x27;</span> })
    <span class="hljs-meta">@IsNotEmpty</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;Invalid label&#x27;</span> })
    <span class="hljs-attr">label</span>: <span class="hljs-built_in">string</span>;

    <span class="hljs-meta">@IsBoolean</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;Invalid checked type&#x27;</span> })
    <span class="hljs-attr">checked</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;

    <span class="hljs-meta">@IsBoolean</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;Invalid removed type&#x27;</span> })
    <span class="hljs-attr">removed</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;

    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-attr">partial</span>: <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">Task</span>&gt;</span>) {
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(<span class="hljs-variable language_">this</span>, partial);
    }
}
</code></pre>
             </div>
<br/>
<ul>
<li><strong><code>plainToInstance:</code></strong> Converts plain objects (like JSON) into class instances, transforming a received JSON object into an instance of the <code>Task</code> class.</li>
<li><strong><code>instanceToPlain:</code></strong> Converts a class instance back into a plain object for serialization or sending in an HTTP response.</li>
</ul>
<p>Here’s how we convert a plain object representing a task into an instance of the <code>Task</code> class using <code>plainToInstance</code>:</p>
<h2>Deserializing</h2><a id="deserializing" title="Deserializing"></a>
<div class="code-block-container">
                <button class="copy-code-btn" onclick="copyToClipboard(this)" title="Copy">
                    <i class="fa-regular fa-clone"></i>
                </button>
                <pre><code class="hljs language-typescript" lang="typescript""><span class="hljs-keyword">import</span> { plainToInstance } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;class-transformer&#x27;</span>;

<span class="hljs-comment">// Plain object</span>
<span class="hljs-keyword">const</span> plainTask = {
    <span class="hljs-attr">label</span>: <span class="hljs-string">&#x27;Complete report&#x27;</span>,
    <span class="hljs-attr">checked</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">removed</span>: <span class="hljs-literal">false</span>,
};

<span class="hljs-comment">// Convert to a Task class instance</span>
<span class="hljs-keyword">const</span> taskInstance = <span class="hljs-title function_">plainToInstance</span>(<span class="hljs-title class_">Task</span>, plainTask);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(taskInstance); <span class="hljs-comment">// Instance of Task</span>
</code></pre>
             </div>
<h2>Serializing</h2><a id="serializing" title="Serializing"></a>
<p>When the application needs to send data to a database or an API, it can serialize the class instance back into a plain object using <code>instanceToPlain</code>.</p>
<div class="code-block-container">
                <button class="copy-code-btn" onclick="copyToClipboard(this)" title="Copy">
                    <i class="fa-regular fa-clone"></i>
                </button>
                <pre><code class="hljs language-typescript" lang="typescript""><span class="hljs-keyword">import</span> { instanceToPlain } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;class-transformer&#x27;</span>;

<span class="hljs-keyword">const</span> taskInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Task</span>({ <span class="hljs-attr">label</span>: <span class="hljs-string">&#x27;Complete report&#x27;</span>, <span class="hljs-attr">checked</span>: <span class="hljs-literal">true</span> });

<span class="hljs-comment">// Convert to a plain object</span>
<span class="hljs-keyword">const</span> plainTask = <span class="hljs-title function_">instanceToPlain</span>(taskInstance);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(plainTask); <span class="hljs-comment">// Plain object</span>
</code></pre>
             </div>
<h2>Data Validation</h2><a id="data-validation" title="Data Validation"></a>
<p>Use validate from <code>class-validator</code> to check if the data is valid:</p>
<div class="code-block-container">
                <button class="copy-code-btn" onclick="copyToClipboard(this)" title="Copy">
                    <i class="fa-regular fa-clone"></i>
                </button>
                <pre><code class="hljs language-typescript" lang="typescript""><span class="hljs-keyword">import</span> { validate } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;class-validator&#x27;</span>;

<span class="hljs-keyword">const</span> taskInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Task</span>({ <span class="hljs-attr">label</span>: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-attr">checked</span>: <span class="hljs-string">&#x27;true&#x27;</span> });

<span class="hljs-title function_">validate</span>(taskInstance).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">errors</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (errors.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Validation failed. Errors: &#x27;</span>, errors);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Validation succeeded&#x27;</span>);
    }
});
</code></pre>
             </div>
<p>By using <code>class-transformer</code> and <code>class-validator</code>, you ensure that class instances are properly validated and easily converted between plain objects and class instances. This provides a strong validation layer and simplifies data handling, especially for APIs and databases.</p>
