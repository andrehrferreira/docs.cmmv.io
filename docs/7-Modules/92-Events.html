<h1>Events</h1><a id="events" title="Events"></a>
<p>The <code>@cmmv/events</code> module provides a robust and flexible event-driven system for managing asynchronous communication within your application. Leveraging <code>eventemitter2</code>, this module enables developers to create, emit, and listen to events seamlessly, enhancing the modularity and scalability of the application.</p>
<h2>Features</h2><a id="features" title="Features"></a>
<ul>
<li><strong>Event Binding:</strong> Easily bind methods to events using the <code>@OnEvent</code> decorator.</li>
<li><strong>Asynchronous Communication:</strong> Facilitate inter-service communication with minimal coupling.</li>
<li><strong>Payload Flexibility:</strong> Supports any payload type, with recommended use of TypeScript interfaces for structured data.</li>
<li><strong>Integration with CMMV Framework:</strong> Built-in compatibility with <code>@cmmv/core</code> modules and services.</li>
<li><strong>Error Handling:</strong> Ensures robust error logging and debugging for event-driven workflows.</li>
</ul>
<h2>Installation</h2><a id="installation" title="Installation"></a>
<p>To install the <code>@cmmv/events</code> module:</p>
<div class="code-block-container">
                <button class="copy-code-btn" onclick="copyToClipboard(this)" title="Copy">
                    <i class="fa-regular fa-clone"></i>
                </button>
                <pre><code class="hljs language-bash" lang="bash"">$ pnpm add @cmmv/events eventemitter2
</code></pre>
             </div>
<h2>Configuration</h2><a id="configuration" title="Configuration"></a>
<p>No additional configuration is required. The <code>@cmmv/events</code> module works out of the box with your CMMV application.</p>
<h2>Setting Up the Application</h2><a id="setting-up-the-application" title="Setting Up the Application"></a>
<p>In your <code>index.ts</code>, include the <code>EventsModule</code> along with any modules or services that use event-based communication:</p>
<div class="code-block-container">
                <button class="copy-code-btn" onclick="copyToClipboard(this)" title="Copy">
                    <i class="fa-regular fa-clone"></i>
                </button>
                <pre><code class="hljs language-typescript" lang="typescript""><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Application</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@cmmv/core&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">DefaultAdapter</span>, <span class="hljs-title class_">DefaultHTTPModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@cmmv/http&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">EventsModule</span>, <span class="hljs-title class_">EventsService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@cmmv/events&#x27;</span>;

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ListernersModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./listeners.module&#x27;</span>;

<span class="hljs-title class_">Application</span>.<span class="hljs-title function_">create</span>({
    <span class="hljs-attr">httpAdapter</span>: <span class="hljs-title class_">DefaultAdapter</span>,
    <span class="hljs-attr">modules</span>: [
        <span class="hljs-title class_">DefaultHTTPModule</span>,
        <span class="hljs-title class_">EventsModule</span>,
        <span class="hljs-title class_">ListernersModule</span>,
    ],
    <span class="hljs-attr">services</span>: [<span class="hljs-title class_">EventsService</span>],
});
</code></pre>
             </div>
<h2>Usage</h2><a id="usage" title="Usage"></a>
<h3>Creating Event Listeners</h3>
<p>Use the <code>@OnEvent</code> decorator to bind a method to an event. Event listeners can be added to any service, controller, or gateway in your application.</p>
<div class="code-block-container">
                <button class="copy-code-btn" onclick="copyToClipboard(this)" title="Copy">
                    <i class="fa-regular fa-clone"></i>
                </button>
                <pre><code class="hljs language-typescript" lang="typescript""><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Service</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@cmmv/core&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">OnEvent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@cmmv/events&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">EventsService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@cmmv/events&#x27;</span>;

<span class="hljs-meta">@Service</span>(<span class="hljs-string">&#x27;listener&#x27;</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Listener</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">eventsService</span>: <span class="hljs-title class_">EventsService</span></span>) {}

    <span class="hljs-meta">@OnEvent</span>(<span class="hljs-string">&#x27;hello-world&#x27;</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-title class_">OnReceiveMessage</span>(<span class="hljs-attr">payload</span>: <span class="hljs-built_in">any</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;hello-world event received:&#x27;</span>, payload);
    }
}
</code></pre>
             </div>
<h3>Emitting Events</h3>
<p>To emit an event, inject <code>EventsService</code> into your class and call the <code>emit</code> method:</p>
<div class="code-block-container">
                <button class="copy-code-btn" onclick="copyToClipboard(this)" title="Copy">
                    <i class="fa-regular fa-clone"></i>
                </button>
                <pre><code class="hljs language-typescript" lang="typescript""><span class="hljs-variable language_">this</span>.<span class="hljs-property">eventsService</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;event-name&#x27;</span>, { <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;value&#x27;</span> });
</code></pre>
             </div>
<br/>
<ul>
<li><strong>First Parameter:</strong> Name of the event.</li>
<li><strong>Second Parameter:</strong> Payload for the event (any type). Recommended to use a TypeScript interface for the payload structure.</li>
</ul>
<h3>Example Event Emission</h3>
<div class="code-block-container">
                <button class="copy-code-btn" onclick="copyToClipboard(this)" title="Copy">
                    <i class="fa-regular fa-clone"></i>
                </button>
                <pre><code class="hljs language-typescript" lang="typescript""><span class="hljs-variable language_">this</span>.<span class="hljs-property">eventsService</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;user.created&#x27;</span>, { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;John Doe&#x27;</span> });
</code></pre>
             </div>
<h2>Decorators</h2><a id="decorators" title="Decorators"></a>
<h3><code>@OnEvent(eventName: string)</code></h3>
<p>Binds a method to listen for a specific event.</p>
<h2>Best Practices</h2><a id="best-practices" title="Best Practices"></a>
<ul>
<li><strong>Use Interfaces for Payloads:</strong> Define TypeScript interfaces for event payloads to ensure consistency and type safety.</li>
<li><strong>Group Related Events:</strong> Use event namespaces or prefixes to group related events (e.g., <code>user.created</code>, <code>user.updated</code>).</li>
</ul>
<h2>Example Application</h2><a id="example-application" title="Example Application"></a>
<p>Here is an example of an application utilizing the <code>@cmmv/events</code> module:</p>
<div class="code-block-container">
                <button class="copy-code-btn" onclick="copyToClipboard(this)" title="Copy">
                    <i class="fa-regular fa-clone"></i>
                </button>
                <pre><code class="hljs language-typescript" lang="typescript""><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Application</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@cmmv/core&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">DefaultAdapter</span>, <span class="hljs-title class_">DefaultHTTPModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@cmmv/http&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">EventsModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@cmmv/events&#x27;</span>;

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UserModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./user.module&#x27;</span>;

<span class="hljs-title class_">Application</span>.<span class="hljs-title function_">create</span>({
    <span class="hljs-attr">httpAdapter</span>: <span class="hljs-title class_">DefaultAdapter</span>,
    <span class="hljs-attr">modules</span>: [
        <span class="hljs-title class_">DefaultHTTPModule</span>,
        <span class="hljs-title class_">EventsModule</span>,
        <span class="hljs-title class_">UserModule</span>,
    ],
});
</code></pre>
             </div>
<h3>User Module</h3>
<div class="code-block-container">
                <button class="copy-code-btn" onclick="copyToClipboard(this)" title="Copy">
                    <i class="fa-regular fa-clone"></i>
                </button>
                <pre><code class="hljs language-typescript" lang="typescript""><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@cmmv/core&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UserListener</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./listeners/user.listener&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">UserModule</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Module</span>(<span class="hljs-string">&#x27;user&#x27;</span>, {
    <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">UserListener</span>],
});
</code></pre>
             </div>
<h3>User Listener</h3>
<div class="code-block-container">
                <button class="copy-code-btn" onclick="copyToClipboard(this)" title="Copy">
                    <i class="fa-regular fa-clone"></i>
                </button>
                <pre><code class="hljs language-typescript" lang="typescript""><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Service</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@cmmv/core&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">OnEvent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@cmmv/events&#x27;</span>;

<span class="hljs-meta">@Service</span>(<span class="hljs-string">&#x27;user-listener&#x27;</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserListener</span> {
    <span class="hljs-meta">@OnEvent</span>(<span class="hljs-string">&#x27;user.created&#x27;</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">handleUserCreated</span>(<span class="hljs-params"><span class="hljs-attr">payload</span>: { id: <span class="hljs-built_in">number</span>; name: <span class="hljs-built_in">string</span> }</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`User created:`</span>, payload);
    }
}
</code></pre>
             </div>
<h3>Emitting Events in a Controller</h3>
<div class="code-block-container">
                <button class="copy-code-btn" onclick="copyToClipboard(this)" title="Copy">
                    <i class="fa-regular fa-clone"></i>
                </button>
                <pre><code class="hljs language-typescript" lang="typescript""><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Controller</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@cmmv/core&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">EventsService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@cmmv/events&#x27;</span>;

<span class="hljs-meta">@Controller</span>(<span class="hljs-string">&#x27;user&#x27;</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">eventsService</span>: <span class="hljs-title class_">EventsService</span></span>) {}

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params"></span>) {
        <span class="hljs-comment">// Perform user creation logic...</span>

        <span class="hljs-comment">// Emit user.created event</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventsService</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;user.created&#x27;</span>, { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;John Doe&#x27;</span> });
    }
}
</code></pre>
             </div>
<h2>Advantages</h2><a id="advantages" title="Advantages"></a>
<ul>
<li><strong>Decoupled Logic:</strong> Enables better separation of concerns by decoupling event emitters and listeners.</li>
<li><strong>Scalable Communication:</strong> Ideal for applications with complex workflows requiring event-based communication.</li>
<li><strong>Seamless Integration:</strong> Works out of the box with the CMMV framework, simplifying setup and usage.</li>
</ul>
